<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>IPM:International Portfolio Manager</title>
	<!--JQuery library-->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js"></script>
</head>
<body>
	<a href="../home/home.html" title="Clik here to return to the home page">
	<img src="../images/logo.gif" alt="International Portfolio Manager" height="150" width="300"/></a>
		<div>
			HOME
			<a href="../watchlist/watchlist.html">WATCHLIST</a>
			<a href="../calculator/calculator.html">CALCULATOR</a>
			<a href="../portfolio/portfolio.html">PORTFOLIO MANAGER</a>
			<a href="../contact/contact.html">CONTACT</a>
		</div>
     <form>
		<input type="submit" value="DJIA"/>
		<input type="submit" value="DAX"/>
		<input type="submit" value="FTSE 100"/>
	</form>
	<div id="quote">
<!--Create the table that will hold the stock information returned by the AJAX call-->
	<table cellspacing="0" cellpadding="3" border="1">
	<tr>
		<th>Name</th>
		<th>Last Trade</th>
		<th>Change</th>
		<th>% change</th>
		<th>Day's Low</th>
		<th>Day's High</th>
		<th>Year's Low</th>
		<th>Year's High</th>
		<th>Last Trade Time</th>
		<th>Last Trade Date</th>
	</tr>
	<tr>
		<td id="name"></td>
		<td id="lastTrade"></td>
		<td id="change"></td>
		<td id="%change"></td>
		<td id="dayLow"></td>
		<td id="dayHigh"></td>
		<td id="yearLow"></td>
		<td id="lastTradeTime"></td>
		<td id="lastTradeDate"></td>
	</tr>
	</table>
	</div>
<script type="text/javascript">
$(window).load(function () {
            StockPriceTicker();
            setInterval(function() {StockPriceTicker();} , 60000);
        });
        function StockPriceTicker() {
            var Symbol = "", CompName = "", Price = "", ChnageInPrice = "", PercentChnageInPrice = "", PriceDaysLow = "", PriceDaysHigh = "", PriceYearLow = "", PriceYearHigh = ""; 
            var CNames = "^FTSE,HSBA.L,YHOO,AAPL,GOOG,MSFT,SL.L,BATS.L,BLND.L,FLG.L,RBS.L,RMG.L,VOD.L";
            var flickerAPI = "http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22" + CNames + "%22)&env=store://datatables.org/alltableswithkeys";
			//var api = "http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22YHOO%22%2C%22AAPL%22%2C%22GOOG%22%2C%22MSFT%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=";
		    var StockTickerHTML = "";
                //var StockTickerXML = $.get(api, function(xml) {
            var StockTickerXML = $.get(flickerAPI, function(xml) {
                $(xml).find("quote").each(function () {
                    Symbol = $(this).attr("symbol");
                    $(this).find("Name").each(function () {
                        CompName = $(this).text();
                    });
                    $(this).find("LastTradePriceOnly").each(function () {
                        Price = $(this).text();
                    });
                    $(this).find("Change").each(function () {
                        ChnageInPrice = $(this).text();
                    });
                    $(this).find("PercentChange").each(function () {
                        PercentChnageInPrice = $(this).text();
                    });
                    $(this).find("DaysLow").each(function () {
                        PriceDaysLow = $(this).text();
                    });    
                    $(this).find("DaysHigh").each(function () {
                        PriceDaysHigh = $(this).text();
                    }); 
                    $(this).find("YearLow").each(function () {
                        PriceYearLow = $(this).text();
                    });    
                    $(this).find("YearHigh").each(function () {
                        PriceYearHigh = $(this).text();
                    }); 
					
                    var PriceClass = "GreenText", PriceIcon="up_green";
                    if(parseFloat(ChnageInPrice) < 0) { PriceClass = "RedText"; PriceIcon="down_red"; }
                    StockTickerHTML = StockTickerHTML + "<span class='" + PriceClass + "'>";
                    StockTickerHTML = StockTickerHTML + "<span class='quote'>" + CompName + " (" + Symbol + ")</span> ";
                    
                    StockTickerHTML = StockTickerHTML + parseFloat(Price).toFixed(2) + " ";
                    StockTickerHTML = StockTickerHTML + "<span class='" + PriceIcon + "'></span>" + parseFloat(Math.abs(ChnageInPrice)).toFixed(2) + " (";
                    StockTickerHTML = StockTickerHTML + parseFloat( Math.abs(PercentChnageInPrice.split('%')[0])).toFixed(2) + "%)</span>";
                });
				
                $("#dvStockTicker").html(StockTickerHTML);
                //$("#dvStockTicker").jStockTicker({interval: 30, speed: 2});
            });
        }
</script>
</head>
<body>
<!--HTML markup-->
    <!--<div id="StockTickerContainer" style="height: 32px; line-height: 32px; overflow: hidden;">-->
        <div id='dvStockTicker' class='stockTicker'>
        </div>
    </div>
<!--<script>
// Base URI for Web service  
var yql_base_uri = "http://query.yahooapis.com/v1/yql";  
  
// Create a variable to make results available  
// in the global namespace  
var yql_results = "";  
  
// Create a YQL query to get geo data for the  
// San Francisco International Airport  
var yql_query = "select * from yahoo.finance.quotes where symbol in ("YHOO","AAPL","GOOG","MSFT")";  
  
// Callback function for handling response data  
function handler(rsp) {     
  if(rsp.data){             
    yql_results = rsp.data;  
  }  
}
// This utility function creates the query string  
// to be appended to the base URI of the YQL Web  
// service.  
function toQueryString(obj) {      
  var parts = [];      
  for(var each in obj) if (obj.hasOwnProperty(each)) {  
    parts.push(encodeURIComponent(each) + '=' + encodeURIComponent(obj[each]));      
  }      
  return parts.join('&');    
}; 
// Store the anonymous function that wraps  
// the OpenSocial function makeRequest  
var runQuery = function(ws_base_uri,query, handler) {  
  gadgets.io.makeRequest(ws_base_uri, handler, {  
    METHOD: 'POST',  
    POST_DATA: toQueryString({q: query, format: 'json'}),  
    CONTENT_TYPE: 'JSON',  
    AUTHORIZATION: 'OAuth'      
  });    
};  
</script>

<div id="results"></div>  

<script>  
// Call YQL Web service and use YQL query  
// to get results from the GEO   
runQuery(yql_base_uri,yql_query,handler);  
  
// Use stringify function from OpenSocial library  
// to convert JSON to string and display the string  
// in the div with the id 'results'  
document.getElementById('results').innerHTML = gadgets.json.stringify(yql_results.data);    
</script>-->

</body>
</html>